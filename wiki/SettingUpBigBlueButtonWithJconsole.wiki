#summary Setting up BigBlueButton with JConsole

= Introduction =

In this section we are going to describe how to set up our [http://code.google.com/p/bigbluebutton/ BigBlueButton] server with [http://download.oracle.com/javase/6/docs/technotes/tools/share/jconsole.html  Jconsole, the Java Management and Monitoring Tool]for the purposes of monitoring the performance of our BBB server (memory consumption, CPU usage, threads, etc). Bare in mind we are monitoring the Red5 process only.

Jconsole itself can put load on your server that is why it is recommended to connect it remotely to your server in order to have correct results (there are other ways we might have space to mentions them). [http://www.red5tutorials.net/index.php/An_idiot's_guide_to_RMI/JMX_remote_connections_-_without_SSL_/_authentication See this link]

So in our case we are going to setup the [http://code.google.com/p/bigbluebutton/ BigBlueButton] Server.

= Details =

To start with we will need to configure our Red5 server JMXRMI for remote connection to allow Jconsole to connect to the Red5 process. 

I have started with the "simple" steps described in this [http://www.red5tutorials.net/index.php/An_idiot's_guide_to_RMI/JMX_remote_connections_-_without_SSL_/_authentication Red5 wiki page] and hoping it would work without problems. 

Well, we had issues and here how we worked them out:

1. Problem with the IP address or host name as it doesn't resolve to you server IP and it might sa in the debug error message the host IP or172.0.0.1 or 0.0.0.0. So to fix that we have to make sure that we have the "right" settings for our Red5 JMX/RMI by editing  remote JMX section red5.properties file. 
Here is what it should look like after editing it: 

{{{jmx.rmi.port.registry=9999}}}

{{{jmx.rmi.port.remoteobjects=}}} 

{{{jmx.rmi.host=0.0.0.0}}} 

{{{jmx.rmi.ssl=false}}}

{{{jmx.http=false}}}

{{{jmx.http.port=8082}}}

2. Now that we we will have another problem, after few attempts failing to connect to the red5 process on the BBB server, we had discovered that we need to setup the SSL for the Jconsole red5/JMX connection! To work that out you can follow the steps described in the "Enabling SSL" and the "Enabling the Client SSL authontication", [http://www.componative.com/content/controller/developer/insights/jconsole2/index.html in this web page] (it is for JBoss server but pretty much is what we had to do in the case of BBB).

3. When you get to the last step and get to the jconsole connection dialogbox appears and we enter the URI for our red5 process 

{{{service:jmx:rmi://YOUR_IP:JMX_PORT/jndi/rmi://YOUR_IP:JMX_PORT/red5}}} 

Now by doing that you might success to connect or like what happened to me it didn't work (typical) you might get this message 

{{{Authentication failed! Credentials required}}}

So we need to a user name and password to connect to the Red5 JMX and the default user name and password for Red5 is  (default user//password are red5user//changeme) 

Now you should be able to see the Jconsole main window and you go from there.

{{{
red5.properties

rtmps.keystorepass=password

# JMX
jmx.rmi.port.registry=9999
jmx.rmi.port.remoteobjects=
jmx.rmi.host=192.168.0.166
jmx.rmi.ssl=true

password.properties
red5user changeme

cd /usr/share/red5/conf
sudo keytool -genkey -alias jconsole -keystore red5JConsoleKeyStore
keytool -list -keystore red5JConsoleKeyStore
sudo keytool -export -alias jconsole -keystore red5JConsoleKeyStore -file jconsole.cert
mv jconsole.cert ~/


conf/red5-common.xml
        <bean id="jmxAgent" class="org.red5.server.jmx.JMXAgent" init-method="init">
                <!-- The RMI adapter allows remote connections to the MBeanServer -->
                <property name="enableRmiAdapter" value="true"/>
                <property name="rmiAdapterPort" value="${jmx.rmi.port.registry}"/>
                <property name="rmiAdapterRemotePort" value="${jmx.rmi.port.remoteobjects}"/>
                <property name="rmiAdapterHost" value="${jmx.rmi.host}"/>
                <property name="enableSsl" value="${jmx.rmi.ssl}"/>
                <!-- Starts a registry if it doesnt exist -->
                <property name="startRegistry" value="true"/>
                <!-- Authentication -->
                <property name="remoteAccessProperties" value="${red5.config_root}/access.properties"/>
                <property name="remotePasswordProperties" value="${red5.config_root}/password.properties"/>
                <property name="remoteSSLKeystore" value="${red5.config_root}/red5JConsoleKeyStore"/>
                <property name="remoteSSLKeystorePass" value="${rtmps.keystorepass}"/>
                <!-- Mina offers its own Mbeans so you may integrate them here -->
                <property name="enableMinaMonitor" value="false"/>
        </bean>^M



D:\visualvm_122>keytool -import -alias red5 -keystore C:\Java\jdk1.6.0_07\bin\red5KeyStore -file jconsole.cert
Enter keystore password:
Re-enter new password:




D:\visualvm_122\bin>jconsole -J-Djavax.net.ssl.keyStore="C:\Java\jdk1.6.0_07\bin\red5KeyStore" -J-Djavax.net.ssl.keyStorePassword=password -J-Djavax.net.ssl.trustStore="C:\Java\jdk1.6.0_07\bin\red5KeyStore"

D:\visualvm_122\bin>visualvm -J-Djavax.net.ssl.keyStore="C:\Java\jdk1.6.0_07\bin\red5KeyStore" -J-Djavax.net.ssl.keyStorePassword=password -J-Djavax.net.ssl.trustStore="C:\Java\jdk1.6.0_07\bin\red5KeyStore"

}}}

 