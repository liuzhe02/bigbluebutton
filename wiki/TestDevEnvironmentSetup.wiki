#summary This page is under construction.

<wiki:toc max_depth="2" />

= Overview =
This document describes how to setup a development environment on a !BigblueButton server.  Once setup, you can make changes to !BigBlueButton for deployment on your server.

This guide is written for !BigBlueButton 0.81-dev or later.  If you are using an earlier version of !BigBlueButton, you'll need to update you server (see 081InstallationUbuntu).  

!BigBlueButton has many components that are grouped together to provide the core funcationality.  The main components are 

  * bbb-web -- implementation of the !BigBlueButton API and conversion of documents
  * bbb-client -- Flash based client
  * bbb-apps -- Server side applications for modules that run within the client
  * bbb-voice -- Server side components for implementing voice
  * bbb-deskshare -- Desktop sharing applet and server  

You don't need to understand everything about each component, but you do need to understand how the overall architecture (see ArchitectureOverview).  If you are interested in improving the !BigBlueButton client, you need, at a minimum, to understand the bigbluebutton-client and the overall client architecture interacts with the server.

== Before you begin ==

These instructions setup a development environment on a working !BigBlueButton server installed via packaging (see InstallationUbuntu).

The source for !BigBlueButton is managed by git and is hosted on GitHup (see [https://github.com/bigbluebutton/bigbluebutton source code].  You need to be familiar with how git works.  Specifically, how to

  * clone a repository
  * create a branch
  * push changes back to a repository

If you don't know what the terms *_clone_*, *_branch_*, and *_commit_* mean in git, make sure you do before working with the !BigBlueButton source, a good place to start is [http://progit.org/book/ free book] and http://help.github.com/ !GitHub Help pages].  

=== Setup a Working !BigBlueButton Server ===

While it may seem obvious, we emphasize your !BigBlueButton server should be working *before* you start setting up the development environment.  That way, if you do run a modified version of the !BigBlueButton client, for example, and something isn't working, you can switch back to the built-in client to check that your environment is working correctly.

=== Developing on Windows ===
If you are on Windows, we recommend you download the [BigBlueButtonVM BigBlueButton VM] and use it for compiling and testing your changes.  Much of the core development of !BigBlueButton is done using FlexBuilder on Windows and running the !BigBlueButton server in a virtual machine under VMWare Workstation.

=== You'll need sudo abilities ===
To setup the !BigBlueButton development environment. To verify, you should be able to

{{{
  sudo ls
}}}

and get back a list of files in the current directory.


= Setup a Development Environment =

== Setting up the Development Tools ==

On a !BigBlueButton server, you can install all the necessary development tools by following the steps below:

First you need to install the core development tools.
{{{
sudo apt-get install git-core ant openjdk-6-jdk
}}}

Next you need to make a directory to hold the tools needed for BigBlueButton development.
{{{
mkdir -p ~/dev/tools
cd ~/dev/tools
}}}

Then we need to grab and install the actual BigBlueButton development tools. We need to install gradle-0.8, grails-1.1.1, and groovy-1.6.5. It's a good idea to read up on your own and get familiar with the uses and roles of these tools, it will help you understanding of their use in BigBlueButton.

For each of the three tools you will need to download a tar.gz file with wget and then unpack it with tar. The code for downloading and unpacking gradle is below.
{{{
wget http://bigbluebutton.googlecode.com/files/gradle-0.8.tar.gz
tar xvfz gradle-0.8.tar.gz
}}}

Next we need to get the Flex 4.5 SDK package. It's important to note that even though we're downloading the Flex 4.5 SKD BigBlueButton is developed and built with Flex 3 compatibility mode enabled.

First we have to download the zipped up SDK from the Adobe site.
{{{
wget http://fpdownload.adobe.com/pub/flex/sdk/builds/flex4.5/flex_sdk_4.5.0.20967_mpl.zip
}}}

Then we need to make a directory for it and unzip it.
{{{
mkdir -p ~/dev/tools/flex-4.5.0.20967
unzip flex_sdk_4.5.0.20967_mpl.zip -d flex-4.5.0.20967
}}}

The Flex SDK is now unzipped and ready to go, but the permissions aren't in good shape. We need to fix them.
{{{
sudo find ~/dev/tools/flex-4.5.0.20967 -type d -exec chmod o+rx '{}' \;
chmod 755 ~/dev/tools/flex-4.5.0.20967/bin/*
sudo chmod -R +r ~/dev/tools/flex-4.5.0.20967
}}}

We can now create a linked directory with a shortened name for easier referencing.
{{{
ln -s ~/dev/tools/flex-4.5.0.20967 ~/dev/tools/flex
}}}

For the final thing to download we need to get a library to facilitate h264 video in the client.
{{{
mkdir -p flex-4.5.0.20967/frameworks/libs/player/11.2
cd flex-4.5.0.20967/frameworks/libs/player/11.2
wget http://download.macromedia.com/get/flashplayer/updaters/11/playerglobal11_2.swc
mv -f playerglobal11_2.swc playerglobal.swc
}}}

Now we need to setup environment variables for all the development tools we've just downloaded.  
{{{ 
vi ~/.profile
}}} 

and paste the following text at bottom of file.

{{{

export GROOVY_HOME=$HOME/dev/tools/groovy-1.6.5
export PATH=$PATH:$GROOVY_HOME/bin

export GRAILS_HOME=$HOME/dev/tools/grails-1.1.1
export PATH=$PATH:$GRAILS_HOME/bin

export FLEX_HOME=$HOME/dev/tools/flex
export PATH=$PATH:$FLEX_HOME/bin

export GRADLE_HOME=$HOME/dev/tools/gradle-0.8
export PATH=$PATH:$GRADLE_HOME/bin

export JAVA_HOME=/usr/lib/jvm/java-6-openjdk
export ANT_OPTS="-Xmx512m -XX:MaxPermSize=512m"

}}}

For the final step in the process you'll need to reload your `.profile` to use the new environment variables for groovy, grails, and gradle.  To do this, run

{{{
source ~/.profile
}}}

You need only do this once.  When you next login to your account, you'll have the environment variables in place.

Again, you can use any account on a !BigBlueButton server that has sudo rights.  For the rest of this document we'll use the account `firstuser` for the examples.  Replace this with ubuntu or other user account name as needed.

The following directory:

{{{
  /home/firstuser/dev
}}}

It's where you'll place the source for !BigBlueButton.

== Checking out the Source ==

We recommend you use !GitHub to fork !BigBlueButton.  This will make it easy for to work on your own copy of !BigBlueButton's source, store updates to !GitHub, and [Contributing_to_BigBlueButton contribute] back to the project by sending us pull requests.

To checkout the source:

 # Setup an account on [https://github.com/plans GitHub] if you don't already have one (it's free!)
 # Setup your [http://help.github.com/linux-set-up-git/ ssh keys]. Skip to the "Set Up SSH Keys" section.
 # [http://help.github.com/fork-a-repo/ Fork] the !BigBlueButton repository into your !GitHub account
 # Clone your repository into your `~/dev` folder


After cloning, you'll have the following directory (make sure the `bigbluebutton` directory is within your `dev` directory).

{{{
/home/firstuser/dev/bigbluebutton
}}}

Confirm that you are working on the master branch.

{{{
cd ~/dev/bigbluebutton
git status
}}}

You should see

{{{ 
# On branch master
nothing to commit (working directory clean)
}}}

When you installed !BigBlueButton from packaging, you have installed components built with the production 0.81 release.  

However, when you first clone the !BigBlueButton git repository, git will place you, by default, on the master branch which is the current snapshot of the latest code for !BigBlueButton.  !BigBlueButton is always under active development.  As such, if you proceed to compile a component of !BigBlueButton, such as the !BigBlueButton client, using master source and attempt to run it with the other 0.81-based components on your server, it may not work.  The !BigBlueButton client may crash (the master branch is not always stable during a development cycle), or you may see a loading message such as "Connecting to server ..." that never clears.  

To get started with development of !BigBlueButton, you want build components using the corresponding source from the 0.80 release.

It's easy to switch your local git repository to the stable 0.80 codebase. When 0.80 was release, the git repository was tagged with the label `v0.8`.   To switch your local repository to the 0.80 codebase, you create a branch with a new name and append the label `v0.8`.  For example, to create a branch called 'my-bbb-branch', type the git command

{{{
git checkout -b my-bbb-branch v0.8
}}}

You should see

{{{
Switched to a new branch 'my-bbb-branch'
}}}

Do

{{{
git status
}}}

The output should be

{{{
# On branch my-bbb-branch
nothing to commit (working directory clean)
}}}


= Client Development =
With the development environment checked out and the code cloned, we're ready to start developing!

This section will walk you through making a change to the !BigBlueButton client.  

== Setting up the environment ==
To setup the client for development for the client follow the steps below.

The first thing we need to do is copy the config.xml file from the packaged client to our development directory. 
{{{
cp /var/www/bigbluebutton/client/conf/config.xml $BBBCLIENTHOME/src/conf/config.xml
}}}

The config.xml file is one of the first parts of the client that is loaded and it determines what modules are retrieved and what configurable settings they have. New developers should read it over to see what settings they can change without modifying the client code.

It's also important to note that when packaged config.xml is updated by either a repository update or by changing your BigBlueButton server's ip with --setip, the copy of config.xml in your development directory isn't modified. It's up to you to make sure it has the latest changes.

Next we're going to copy an xml file that is used to test the client. *Might be outdated*
{{{
cp $BBBCLIENTHOME/resources/dev/join-mock.xml $BBBCLIENTHOME/src/conf/join-mock.xml
}}}

Now we need to setup nginx to redirect calls to the client towards our development version. If you don't already have a nginx client development file at /etc/bigbluebutton/nginx/client_dev, create one with the following command. Make sure to replace "firstuser" with your own username if it's different.
{{{
echo "
location /client/BigBlueButton.html {
root /home/firstuser/dev/bigbluebutton/bigbluebutton-client;
index index.html index.htm;
expires 1m;
}

# BigBlueButton Flash client.
location /client {
root /home/firstuser/dev/bigbluebutton/bigbluebutton-client;
index index.html index.htm;
}
" | sudo tee /etc/bigbluebutton/nginx/client_dev > /dev/null 2>&1
}}}

Now we need to create a symbolic link so our client redirect works.
{{{
sudo ln -f -s /etc/bigbluebutton/nginx/client_dev /etc/bigbluebutton/nginx/client.nginx
}}}

Now we need to create a symbolic link between the /bin directory where the client is built to and /client so the name is nicer looking.
{{{
ln -s ~/dev/bigbluebutton/bigbluebutton-client/bin ~/dev/bigbluebutton/bigbluebutton-client/client
}}}

Now we need to restart nginx so our changes take effect.
{{{
sudo /etc/init.d/nginx restart
}}}

== Build the client ==
Let's now build the client  Note we're not making any changes yet -- we're going to build the client to ensure it works.

{{{
cd ~/dev/bigbluebutton/bigbluebutton-client
}}}

First, we'll build the locales (language translation files).  If your not modifying the locales, you only need to do this once.

{{{
cd ~/dev/bigbluebutton/bigbluebutton-client
ant locales
}}}

This will take about 10 minutes (depending on the speed of your system). 

Next, let's build the client
{{{
ant
}}}

This will create a build of the !BigBlueButton client in the `~/dev/bigbluebutton/bigbluebutton-client/bin` directory.

After this, point your browser to your !BigBlueButton server and login to the demo page.  The client should start properly.

== Making a change ==

Now that we've built the default client let's make a small visible change to the interface.

{{{
vi ~/dev/bigbluebutton/bigbluebutton-client/src/org/bigbluebutton/main/views/MainApplicationShell.mxml
}}}

The above command uses vi to make a change.  If you are on Windows and developing using the BigBlueButton VM, you may find it easier to setup samba so you can access your files through Windows Explorer and use a Windows editor.  To setup Samba, type

{{{
bbb-conf --setup-samba
}}}

Once you have `MainApplicationShell.mxml` open, at line 311, you'll see the following text

{{{
<mx:Label text="{ResourceUtil.getInstance().getString('bbb.mainshell.copyrightLabel2',[appVersion])}" id="copyrightLabel2"/>
}}}

Insert the text ' -- !BigBlueButton Rocks!!' as shown below.

{{{
 <mx:Label text="{ResourceUtil.getInstance().getString('bbb.mainshell.copyrightLabel2',[appVersion]) + ' -- BigBlueButton Rocks!'}" id="copyrightLabel2"/>
}}}


Now, rebuild the !BigBlueButton client again.

{{{
cd ~/dev/bigbluebutton/bigbluebutton-client
ant
}}}

When done, join the demo meeting using the client. You'll see the message `-- BigBlueButton Rocks!` added to the copyright line.

http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/08/rocks.png

If you don't see your changes, try clearing your browser's cache and then load the client again.

== Switching back to the packaged client ==
To switch back to using the packaged !BigBlueButton client you only need to change the symbolic link for nginx and then restart nginx.

{{{
sudo ln -s -f /etc/bigbluebutton/nginx/client /etc/bigbluebutton/nginx/client.nginx
sudo /etc/init.d/nginx restart
}}}

To switch back to your development setup, simply recreate the symbolic link and restart nginx.

{{{
sudo ln -s -f /etc/bigbluebutton/nginx/client_dev /etc/bigbluebutton/nginx/client.nginx
sudo /etc/init.d/nginx restart
}}}

=== Using Flex/Flash Builder ===
To develop the client using Flash Builder, follow these steps:
 # Install Flash Builder on your Windows/Mac machine.
 # Setup samba on the VM and mount the VM drive as described earlier in this document.
 # In Flash Builder, import the project by going to File -> Import -> Flash Builder Project.
   # Select the Project Folder radio
   # Click Browse and choose the bigbluebutton-client directory in your VM. For example W:\dev\source\bigbluebutton\bigbluebutton-client
   # Click finish.
 # From the !BigBlueButton VM, copy the flx sdk from ~/dev/tools into the Flash Builder SDK dir. You can see the location on the image below. Then, on Flash Builder, click Window -> Preferences -> Installed Flex SDKs and Add the SDK you have just copied. http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/08/flex-sdk.png
 # Right click on the project, go to Properties -> Flex Compiler, and change the Flex version to 3.5. (!BigBlueButton does not yet work with Flex 4). Make sure the Flash Player specific version is set to at least 10.3.0. Also, check the "Flex 3 compatibility mode" option. Click Apply. http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/08/flex-compiler.png
 # Right-click on the project, click Properties -> Flex Build Path. Click on MX only component set. Make sure you add the libs directory into the path, the main source folder and the output folder. http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/08/flex-build-path.png
 # In the Flex Modules section of the properties window, add all the modules that you would like compiled with bbb-client. The modules are mxml files located in the src/ directory (default package). http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/08/flex-modules.png
 # In the Package Explorer navigate to src/(default package) and _Right Click_ on !BigBlueButton.mxml and click on Set As Default Application.
 # Compile the client in Flash Builder, then open the client in your browser by going to the VM IP. The client running there should now be the client in your Flash Builder environment.

This approach is limited in the sense that you can't use the Run button within Flash Builder to launch the client. You also can't use the Flex debugger. To be able to launch the client from Flash Builder, do the following:
 # On the client code, edit {{{src/conf/config.xml}}} and near the top change the line:

{{{
<application uri="rtmp://<HOST-IP>/bigbluebutton" host="http://<HOST-IP>/bigbluebutton/api/enter" />
}}} 
to
{{{
<application uri="rtmp://<HOST-IP>/bigbluebutton" host="conf/join-mock.xml" />
}}}
 # You should now be able to launch from Flash Builder using the Run/Debug button.

= Developing BBB-Web =

This section will walk you through the steps to set up development for bigbluebutton-web.

First we need to copy the bigbluebutton.properties file from the packaged bbb-web to our development folder.
{{{
cp /var/lib/tomcat6/webapps/bigbluebutton/WEB-INF/classes/bigbluebutton.properties ~/dev/bigbluebutton/bigbluebutton-web/grails-app/conf
}}}

Now you need to give your user account access to upload slides to the presentation directory and also access to write log files.
{{{
sudo chmod -R ugo+rwx /var/bigbluebutton
sudo chmod -R ugo+rwx /var/log/bigbluebutton
}}}

Now you need to create the nginx file that will redirect calls to your development bbb-web.
{{{
echo "
# Handle request to bbb-web running within Tomcat. This is for
# the BBB-API and Presentation.
location /bigbluebutton {
proxy_pass http://127.0.0.1:8888;
proxy_redirect default;
proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;

# Allow 30M uploaded presentation document.
client_max_body_size 30m;
client_body_buffer_size 128k;

proxy_connect_timeout 90;
proxy_send_timeout 90;
proxy_read_timeout 90;

proxy_buffer_size 4k;
proxy_buffers 4 32k;
proxy_busy_buffers_size 64k;
proxy_temp_file_write_size 64k;

include fastcgi_params;
}
" | sudo tee /etc/bigbluebutton/nginx/web_dev > /dev/null 2>&1
}}}

Now we just need to create a link so that the requests are redirected properly and restart nginx.
{{{
sudo ln -s -f /etc/bigbluebutton/nginx/web_dev /etc/bigbluebutton/nginx/web.nginx
sudo /etc/init.d/nginx restart
}}}

Now let's start grails webapp.
{{{
cd ~/dev/bigbluebutton/bigbluebutton-web/
}}}

Download the necessary libraries.
{{{
gradle resolveDeps
}}}

Tell grails to listen on port 8888
{{{
grails -Dserver.port=8888 run-app
}}}

If you get an error {{{ "Could not resolve placeholder 'apiVersion'"}}}., just run {{{grails -Dserver.port=8888 run-app}}} again. The error is grails not picking up the "bigbluebutton.properties" the first time.

Now test again if you can join the demo meeting.

= Developing the Red5 Applications =

Make red5/webapps writeable. Otherwise, you will get permission error when you try to deploy into Red5.

{{{
  sudo chmod -R o+w /usr/share/red5/webapps
}}}

===Developing BBB-Apps===
Run the setup script. This will remove the bbb-apps package from red5/webapps.

{{{
sudo apt-get purge --yes bbb-apps
}}}

Before you build and deploy bbb-apps you need to make sure to first stop the red5 service.
{{{
sudo sevice red5 stop
}}}

Now you can compile and deploy bigbluebutton-apps.
{{{
cd /home/firstuser/dev/bigbluebutton/bigbluebutton-apps
gradle resolveDeps
gradle clean war deploy
}}}

And finally you can start the red5 service up again.
{{{
sudo service red5 start
}}}

== Developing BBB-Voice ==

First you need to stop red5.
{{{
sudo service red5 stop
}}}

Then you can compile and deploy the application.
{{{
cd /home/firstuser/dev/bigbluebutton/bbb-voice
gradle resolveDeps
gradle war deploy
}}}

And finally start red5 up again.
{{{
sudo service red5 start
}}}

== Developing Deskshare ==
{{{
cd /home/firstuser/dev/bigbluebutton/deskshare
gradle resolveDeps
}}}

*Building the applet.*
{{{
cd applet
gradle jar
}}}

Now we need to create a key to sign the applet. Enter a password when prompted for one. Make sure it is at least 6 chars long.
{{{
ant create-signing-key
}}}

Sign the jar file. Enter the password you created from the previous step when prompted.
{{{
ant sign-jar
}}}

If you get an error something like
{{{
sign-jar:
  [signjar] Signing JAR: /home/firstuser/dev/bigbluebutton/deskshare/applet/build/libs/bbb-deskshare-applet-0.71.jar to /home/firstuser/dev/bigbluebutton/deskshare/applet/build/libs/bbb-deskshare-applet-0.71.jar as code.signer
  [signjar] jarsigner: unable to sign jar: java.util.zip.ZipException: duplicate entry: com/myjavatools/web/ClientHttpRequest.class
  [signjar] Enter Passphrase for keystore:

BUILD FAILED
/home/firstuser/dev/bigbluebutton/deskshare/applet/build.xml:70: jarsigner returned: 1

Total time: 3 seconds
}}}

Somehow, some classes got duplicated. Try recompiling the common dir.
{{{
  cd ../common
  gradle clean
  gradle jar
}}}

Then sign the applet again.


The signed jar file is located in {{{/home/firstuser/dev/bigbluebutton/deskshare/applet/build/libs/bbb-deskshare-applet-0.8.jar}}}

We need to copy it to where nginx is loading the client.

If you are developing also the bbb-client, then
{{{
cp /home/firstuser/dev/bigbluebutton/deskshare/applet/build/libs/bbb-deskshare-applet-0.8.jar /home/firstuser/dev/bigbluebutton/bigbluebutton-client/client
}}}

If you are not developing the client, therefore, nginx will serve the client from the default location. Therefore, 
{{{
cp /home/firstuser/dev/bigbluebutton/deskshare/applet/build/libs/bbb-deskshare-applet-0.8.jar /var/www/bigbluebutton/client/
}}}

*Building the server side component.*
{{{

cd /home/firstuser/dev/bigbluebutton/deskshare/app
# Compile
gradle war
# Copy over to Red5
gradle deploy

# Stop red5
    sudo /etc/init.d/red5 stop

cd /home/firstuser/dev/bigbluebutton/bigbluebutton-apps
# Compile and deploy bbb-apps
gradle war deploy

# On another terminal window, start Red5
cd /usr/share/red5/
sudo -u red5 ./red5.sh
}}}

= Troubleshooting =

== Connecting to the server ==
When the !BigBlueButton client loads, it runs a number of modules: chat, voice, desktop sharing, and presentation.  Each of these modules makes a connection back to their corresponding !BigBlueButton server components.

The URL for each connection is specified in [ClientConfiguration#Config.xml config.xml].  

When setting up a development environment for the client, the `config.xml` file for the !BigBlueButton client is now loaded from `~/dev/bigbluebutton/bigbluebutton-client/bin/conf/config.xml`.  This means that any changes made to the default `config.xml` by `sudo bbb-conf --setip <hostname>` will _not_ affect the `config.xml` in your development environment.  Thus, if you change your hostname or IP address for the !BigBlueButton server, you'll need to manually change the `config.xml` for your development environment.


== Welcome to Nginx page ==
If you get the "Welcome to Nginx" page. Check if bigbluebutton is enabled in nginx. You should see *bigbluebutton* in {{{/etc/nginx/sites-enabled}}}.

If not, enable it.

{{{
sudo ln -s /etc/nginx/sites-available/bigbluebutton /etc/nginx/sites-enabled/bigbluebutton

sudo /etc/init.d/nginx restart
}}}

== Old Translation ==
If you get a "Old Translation" warning when starting the client, in `/var/www/bigbluebutton/client/conf/config.xml` change

{{{
<localeversion suppressWarning="false">0.71</localeversion>
}}}

to 

{{{
<localeversion suppressWarning="false">0.8</localeversion>
}}}

= Developing Using Eclipse =
This instructions assumes that you are developing with the VM running on a Windows machine.

Set-up Samba

{{{
 bbb-conf --setup-samba 
}}}

Now map the VM as a network drive.

For each project, you need to generate Eclipse project files. So, in bbb-app, you run the following to generate the project file.

{{{
  gradle eclipse
}}}

Then you can import the project into Eclipse by clicking on File->New-> Java Project. Uncheck "Use default location" and browse to the project you want to import. 