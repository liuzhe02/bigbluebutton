#summary How to develop BigBlueButton 0.71

<wiki:toc max_depth="4" />

= Talking to the developers =
Write to the [http://groups.google.com/group/bigbluebutton-dev/topics?gvc=2&pli=1 bigbluebutton-dev] mailing list, or visit the #bigbluebutton channel on Freenode, using IRC.

= Setting up a !BigBlueButton Development Environment =
The easiest way to develop !BigBlueButton is through an already setup Virtual Machine, which you can download [BigBlueButtonVM here]. The VM has tools already set up which will get you up and running quickly. The VM has an added benefit in that you can develop on it from your Windows or Mac environment, where you can get access to Flash Builder. This document explains how to develop with the VM in mind.

== Acessing your VM ==
From your Windows environment, you'll want to access the !BigBlueButton source code that resides on your VM.  To do this, login to the VM as `firstuser` and issue the following command

{{{
bbb-conf --setup-samba
}}}

This script will share the `/home/firstuser/dev` on your VM so you can access it from within Windows.  Some editors (such as Eclipse) can only access drives (not network shares).  To map this network share to a windows drive (e.g. V:), open Windows Explorer, hit the Alt key, and choose the menu command Tools -> Map Network Drive. For the path, enter `\\<ip>\firstuser`, the ip being the local address of your VM.

See the [BBBConf] page for troubleshooting tips.


== Check Out the Source Code ==
Type the following command to checkout !BigBlueButton from our [http://www.github.com/bigbluebutton github repository].
{{{
bbb-conf --checkout
}}}

This will checkout into {{{/home/firstuser/dev/source/bigbluebutton}}}. 

If you want to learn more about Git, read the book [http://progit.org/book/ Pro Git] especially chapters 1, 2, 3, 5. [http://help.github.com/ GitHub Help] has a lot of information too.

== Compile the Client ==
To setup a development environment for bbb-client, enter the following command
{{{
bbb-conf --setup-dev client
}}}
This will setup some directories and modify nginx config to use your development client.

Everything is now setup to compile bbb-client.

To compile the client:
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-client
ant
}}}

Behind the scenes, nginx is now loading the client from `~/dev/source/bigbluebutton/bigbluebutton-client/bin`.
If the IP address for your !BigBlueButtom VM is 192.168.0.211, you should be able to browse to http://192.168.0.211/, login to the web interface, and see your new client load.    

Every time you make a change to the client source, you need to rebuild it using the 'ant' command in order for the changes to show in your browser. If you haven't changed the localization files then you only need to run
{{{
ant modules
}}}
This will skip building the localization .swf files, and save you a lot of time.

=== Returning to the Packaged Client ===
To revert back to the bbb-client installed from packages, edit `/etc/nginx/sites-available/bigbluebutton` and make the entry for `/client` match the following.

{{{
location /client {
	root    /var/www/bigbluebutton;
	index  index.html index.htm;
}
}}}

Then restart nginx.

{{{
sudo service nginx restart
}}}

== Flash Builder or How to Work with the Client ==
To develop the client using Flash Builder, follow these steps:
 # Install Flash Builder on your Windows/Mac machine.
 # Setup samba on the VM and mount the VM drive as described earlier in this document.
 # In Flash Builder, import the project by going to File->Import->Flash Builder Project.
   # Select the Project Folder radio
   # Click Browse and choose the bigbluebutton-client directory in your VM. For example W:\dev\source\bigbluebutton\bigbluebutton-client
   # Click finish.
 # Right click on the project, go to Properties->Flex Compiler, and change the Flex version to 3.5. (!BigBlueButton does not yet work with Flex 4)
 # In the same window, make sure the Flash Player minimum version is set to at least 10.0.0.
 # In the Flex Modules section of the properties window, add all the modules that you would like compiled with bbb-client. The modules are mxml files located in the src/ directory (default package).
 # In the Package Explorer navigate to src/(default package) and _Right Click_ on !BigBlueButton.mxml and click on Set As Default Application.
 # Compile the client in Flash Builder, then open the client in your browser by going to the VM IP. The client running there should now be the client in your Flash Builder environment.
 This approach is limited in the sense that you can't use the Run button within Flash Builder to launch the client. You also can't use the Flex debugger. To be able to launch the client from Flash Builder, do the following:
 # On the client code, edit {{{src/conf/config.xml}}} and change the 'host' property of the !ViewersModule to point to {{{conf/join-mock.xml}}}.
 # You should now be able to launch from Flash Builder using the Run/Debug button.

== Your First Modification of !BigBlueButton ==
*<font color="44388">_Draft_</font>*<br />
At this point we are going to adorn our rubber boots and jump right in.  We are going to make a small modification to the UI so that you can start perusing the code.
 # In the Package Explorer navigate to src -> org.bigbluebutton -> main -> views -> !MainApplicationShell.mxml
 # Scroll down to near the end of the document and look for {{{<mx:Label text="{ResourceUtil.getInstance().getString('bbb.mainshell.copyrightLabel2',[appVersion])}" id="copyrightLabel2"/>}}}.  This string is the Footer label that contains copyright data, version, etc.
 # Modify the text property to change the text that is displayed. For example:
 {{{
 <mx:Label text="My Modified BigBlueButton Client" id="copyrightLabel2"/>
 }}}
 # To recompile the project save the file you just edited
Congradulations, you have now made your first change to !BigBlueButton.
 
=Developing Other Components of !BigBlueButton=
== Setting up the Development Environment ==
=== !BigBlueButton Web ===
The !BigBlueButton web interface is written in grails, so the development environment different from building the Client (bbb-client).  As before, the first step is to use `bbb-conf` to setup the environment.
<ol>
 <li>Configure the environment
{{{
bbb-conf --setup-dev web
}}}
	This script does the following steps:
  # sets your local IP address into  `~/.grails/bigbluebutton-config.properties`
  # make all files in `/var/bigbluebutton` writable by everyone
	The first step sets up a global property for grails so it knows the IP address of your server when it runs.  The second step opens the permissions to slides directory so `firstuser` can upload a presentation.

	 <b>Note</b>:  If you get an error upload slides when running bbb-web as `firstuser`, run the command `sudo chmod -R ugo+rwx /var/bigbluebutton`.</li>

 <li>Stop Tomcat so you can compile your bbb-web
{{{
sudo service tomcat6 stop
}}} 
</li>
 <li>Compile and run bbb-web
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-web
ant
}}} 
</li>
</ol>
The default task for ant here is to make sure your libraries are up-to-date (using ivy), then execute the command `grails run-app`.  This will output the console to the command line, making it easier for you to see any exceptions thrown by grails.  To stop the grails server, just hit CTRL-C.

If you want to revert back to the web interface installed by the package bbb-web, stop grails and restart the tomcat6 server.
{{{
sudo service tomcat6 start
}}}

 *Note:* After starting the tomcat server try to join a conference. If you receive the message "The page you are looking for is temporarily unavailable. Please try again later.", then the grails server could still be running and not tomcat. Enter the following command

{{{
sudo bbb-conf -c
}}}

If the issue is listed under the Potential Problems heading then to resolve the issue enter

{{{
ps -aef | grep grails
}}}

This will list the grails process. Determine its pid (process id) and kill it. Then start the tomcat server. If the pid was 5012, enter the following commands.

{{{
sudo kill -9 5012
sudo service tomcat6 start
}}}

== BigBlueButton Apps == 

The !BigBlueButton web apps runs within the red5 server.  Unlike development with bbb-web and bbb-client, where we could leave the packaged versions installed, because there is only one red5 server on the VM, we need to remove the existing bbb-apps first.  (Don't worry, you can easily restore it as shown at the end of this section).

To setup a development environment for bbb-apps, enter the following command

{{{
bbb-conf --setup-dev apps
}}}

This will 

  # Enable write access to `/usr/share/red5/webapps`
  # Uninstall the existing `bbb-apps` package
  # Creates a `~/.bbb-apps-build.properties` file that sets the property `red5.home = /usr/share/red5`

Uninstalling the existing `bbb-apps` package will stop the red5 server, remove the directory `/usr/share/red5/webapps/bigbluebutton`, and restart red5.

At this point red5 is still running.  Before we deploy the local version of bbb-apps, let's stop the red5 server.  Open a new terminal window (if you are on windows, we recommend installing [http://www.chiark.greenend.org.uk/~sgtatham/putty/ putty]) and enter the command. 

{{{
sudo service red5 stop
}}}

We'll come back to this separate terminal window in a moment.  Now, let's build and deploy the local copy of bbb-apps.

{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-apps/
gradle war deploy
}}}

At this point, the ant script has copied the local build of bbb-apps to `/usr/share/red5/webapps/bigbluebutton`.  Now switch back to the second terminal window and enter the following command:

{{{
cd /usr/share/red5
sudo -u red5 ./red5.sh
}}}

You'll now see all the output from red5 directly at the console.  Like running the grails server at the command line, running red5 from the command line gives you easy visibility to any errors or exceptions.

If you want to revert back to the packaged version of !BigBlueButton apps, do the following

{{{
rm -rf /usr/share/red5/webapps/bigbluebutton
sudo apt-get install bbb-apps
sudo service red5 start
}}}

= Using the Development Environment =

== Pre-requisites ==
In this environment, we assume you are developing on Windows with Eclipse and Flash Builder. Also, you have the !BigBlueButton VM running on [http://www.vmware.com/ VMware]/[http://www.virtualbox.org/ VirtualBox] and mapped to a drive in your windows machine (see Setting up access to the VM from windows above).

On Windows:
 # Install JDK 6 and add JAVA_HOME in your environment variables
 # Install Eclipse
 # Install the [http://www.scala-ide.org/ Scala Eclipse plugin]
 # Install the [http://groovy.codehaus.org/Eclipse+Plugin Groovy Eclipse plugin]
 # Install Flash Builder
 # Install Grails 1.1.1 and add GRAILS_HOME in your environment variables

=== Client ===
 * See [DevelopBigBlueButtonCurrent#Setting_up_Flash_Builder_to_work_with_the_client Setting up Flash Builder to work with the client].

=== BBB Commons ===
 # The bbb-commons contain classes that are common to bbb-web and bbb-apps.
{{{
cd ~/dev/source/bigbluebutton/bbb-common-message
}}}
 # Generate Eclipse project files
{{{
gradle eclipse
}}}
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bbb-common-message}}}
 # Setup the build path. Right-click on the project, chose Build Path->Configure Build Path
 # Click on the Source tab and add folder {{{src/main/java}}}
 # Compile the classes
{{{
gradle jar  
}}}
 # Copy the jar file to /home/firstuser/dev/repo
{{{
gradle uploadArchives 
}}}

=== BBB Web ===
 # Change directory to {{{bigbluebutton-web}}}
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-web
}}}
 # Download all dependencies specifically bbb-commons from {{{/home/firstuser/dev/repo}}}
{{{
gradle copyToLib 
}}}
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bigbluebutton-web}}}
 # Start bbb-web
{{{
ant 
}}}

*NOTE*: If you encounter an error with the webapp redirecting to an invalid client, open the file {{{./grails-app/conf/bigbluebutton.properties}}} and edit the line bigbluebutton.web.serverURL to point to the url of your machine.

=== BBB apps ===
 # Change directory to {{{bigbluebutton-apps}}}
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-apps
}}}
 # Generate Eclipse project files
{{{
gradle eclipse
}}}
 # Download all dependencies specifically bbb-commons from /home/firstuser/dev/repo
{{{
gradle resolveDeps
}}}
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bigbluebutton-apps}}}
 # Right-click on the project and add Scala Nature and Groovy Nature
 # Setup your build path and library
 # Build the application
{{{
gradle war
}}}
 # Deploy the application to Red5 ({{{/usr/share/red5/webapps}}})
{{{
sudo gradle deploy
}}}

=== Video app ===
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bbb-video}}}
{{{
cd ~/dev/source/bigbluebutton/bbb-video
}}}  
 # Download all dependencies
{{{  
ant resolve
}}}
 # Build the application
{{{
ant dist
}}}
 # Deploy the application to Red5 ({{{/usr/share/red5/webapps}}})
{{{
ant deploy
}}}

=== Voice app ===
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bbb-voice}}}
{{{
cd ~/dev/source/git/bigbluebutton/bbb-video
}}}
 # Download all dependencies 
{{{
gradle copyToLib
}}}
 # Build the application
{{{
gradle war
}}}
 # Deploy the application to Red5 (/usr/share/red5/webapps)
{{{ 
gradle deploy
}}}

=== Desktop Sharing app ===
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/deskshare}}}
{{{
cd ~/dev/source/bigbluebutton/deskshare
}}}
 # Download all dependencies 
{{{
gradle copyToLib
}}}
 # Build the server component
{{{ 
cd app
gradle war
}}}
 # Deploy the application to Red5 ({{{/usr/share/red5/webapps}}})
{{{ 
gradle deploy
}}}
 # To build the applet
{{{  
cd applet
gradle jar
}}}
 # Create the signing key
{{{
ant create-signing-key
}}}
 # Sign the applet
{{{ 
ant sign-jar
}}}
 # Copy deskshare/applet/build/libs/bbb-deskshare-applet-0.64.jar to ~/dev/source/bigbluebutton/bigbluebutton-client/resources
{{{
cp ~/dev/source/bigbluebutton/deskshare/applet/build/libs/bbb-deskshare-applet-0.64.jar ~/dev/source/bigbluebutton/bigbluebutton-client/resources/prod
}}}
 # compile the bbb-client (see Developing with bbb client)

=== TIPS ===
* Run bbb-conf --check *
Run {{{sudo bbb-conf --check}}} to see if there are any potential problems.

====Running Red5====

It is better to have multiple ssh windows when developing. On one window, you can start and stop Red5.
 # Stop Red5
{{{
sudo service red5 stop
}}}
 # cd to Red5 directory
{{{
cd /usr/share/red5
}}}
 # Start Red5 as red5 user
{{{
sudo -u red5 ./red5.sh
}}}

In another window, you can make your code changes and deploy to Red5, e.g.
{{{
cd ~/dev/source/git/bigbluebutton/bigbluebutton-apps
}}}
 # Make some changes
 # Build
{{{
gradle war
}}}
 # Deploy 
{{{
gradle deploy
}}}


====Remove BBB packages====

List the BBB packages by typing
{{{
dpkg -l | grep bbb
}}}

which results:
{{{
ii  bbb-apps                        0.71ubuntu2             BigBlueButton applications for Red5
ii  bbb-apps-deskshare              0.71ubuntu2             BigBlueButton deskshare module for Red5
ii  bbb-apps-sip                    0.71ubuntu2             BigBlueButton SIP module for Red5
ii  bbb-apps-video                  0.71ubuntu2             BigBlueButton video module for Red5
ii  bbb-client                      0.71ubuntu15            BigBlueButton Flash client
ii  bbb-common                      0.71ubuntu6             BigBlueButton common files
ii  bbb-config                      0.71ubuntu6             BigBlueButton group package
ii  bbb-freeswitch-config           0.71ubuntu2             BigBlueButton group package
ii  bbb-openoffice-headless         0.71ubuntu2             BigBlueButton wrapper for OpenOffice
ii  bbb-voice-conference            0.71ubuntu3             BigBlueButton voice conference files
ii  bbb-web                         0.71ubuntu4             BigBlueButton web interface
ii  bigbluebutton                   0.71ubuntu4             Open Source Web Conferencing System (bbb)
}}}

 * To remove a package type {{{apt-get remove <package name>}}}
	Example, if you want to remove bbb-apps
{{{
sudo apt-get remove bbb-apps
}}}

= Developing on the bleeding edge =

== Building the client ==
Here are some extra steps you need to do if you are developing on the {{{master}}} branch. These extra steps are needed because of the changes to the code that's still in development. If you run into issues, please send email to the bigbluebutton-dev mailing list.

Make sure you are on the tip of the blade.
{{{
git pull origin master
}}}

We have added Speex support for BBB Voice. This requires version 3.5 of the Flex SDK. Thus, to build the client, you need to download Flex 3.5 SDK from
http://opensource.adobe.com/wiki/display/flexsdk/Download+Flex+3

Unzip the SDK into your !FlexBuilder/sdk folder and modify the compiler settings to use this SDK.

 # To build using {{{ant}}}, unzip the folder into {{{/home/firstuser/dev/tools}}}.
{{{
cd /home/firstuser/dev/tools
}}}  
 # Uncompress the SDK. This will uncompress the files
{{{
unzip -d flex_sdkflex-3.5.0.12683 flex_sdk_3.5.0.12683_mpl.zip
}}}
 # Check if you have tofrodos
{{{
fromdos
}}}
If it says command not found, you have to install tofrodos
{{{ 
sudo apt-get install tofrodos
}}}
 # Make the needed files unix compatible and executable
{{{
cd flex-3.5.0.12683/bin
fromdos aasdoc acompc amxmlc asdoc compc copylocale digest fcsh fdb mxmlc optimizer
chmod 755 aasdoc acompc amxmlc asdoc compc copylocale digest fcsh fdb mxmlc optimizer
}}}  
 # Backup the included flex3 folder to flex-3.4.1
{{{
cd /home/firstuser/dev/tools
mv flex3 flex-3.4.1
}}}
 # Create a softlink to the 3.5 SDK as the FLEX_HOME env var points to {{{/home/firstuser/dev/tools/flex3}}}
{{{
ln -s flex-3.5.0.12683 flex3
cd /home/firstuser/dev/source/bigbluebutton/bigbluebutton-client
ant
}}} 
*Note*: {{{gradle copyToLib}}} has been changed to {{{gradle resolveDeps}}}, if one doesn't work, try the other as not all instances have been converted.

You will need to run the grails version of bigbluebutton-web which will allow you to see debugging information.  In order to do this tomcat6 needs to be stopped.
{{{
sudo service tomcat6 stop
cd ~/dev/source/bigbluebutton/bigbluebutton-web
}}}
 * Did you already run "bbb-conf --setup-dev web"? If not, run it now


{{{
grails run-war
}}}

Copy a new config.xml as the loading of modules have changed.
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-client
cp resources/config.xml.template src/conf/config.xml
}}}
 * Edit {{{config.xml}}} replacing "HOST" with your IP

== Creating a new !BigBlueButton Module ==
Follow this short [SampleModule tutorial].
 
 
=Troubleshooting=
==Debugging FreeSWITCH==
To start FreeSWITCH so you can see any errors produced by it run:
{{{
sudo /opt/freeswitch/bin/fs_cli
}}}

If voice isn't working in the BBB interface or your listeners are not showing up the most likely reason is that FreeSWITCH and Red5 are not communicating properly.
Check the configuration files and make sure that FreeSWITCH and Red5 are pointing at each other.
Edit {{{/opt/freeswitch/conf/autoload_configs/event_socket.conf.xml}}}. 
{{{
vi /opt/freeswitch/conf/autoload_configs/event_socket.conf.xml
}}}
Check the listen-ip parameter
{{{
<param name="listen-ip" value="192.168.0.211"/>
}}}

Edit {{{/usr/share/red5/webapps/bigbluebutton/WEB-INF/bigbluebutton.properties}}}
Set esl.host to your IP
{{{
esl.host=192.168.0.211
}}}

Lastly, make sure that the sip.server.host property in {{{/usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties}}} is set to your FreeSWITCH server.
{{{
vi /usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties
}}}
Edit the host address to match you own.
{{{
sip.server.host=192.168.0.211
}}}

*Note*: Make sure your two Red5 IPs are ponting to FreeSWITCH and that your FreeSWITHCH IP ip pointing to your Red5 sever.  Otherwise, Red5 won't know what SIP server to use and both FreeSWITCH and Red5 won't be able to communicate events with eachother (stopping the voice users from showing up in the Listeners Window).

==Launching from Flex/Flash Builder==
If you get the compile error:
{{{
unable to open 'W:\dev\source\bigbluebutton\bigbluebutton-client\tests\unit'	bigbluebutton-client		Unknown	Flex Problem
}}}
Just create the missing directories. This is a problem caused by an improperly generated .actionScriptProperties file in bbb-client/


If you get the compile error:
{{{
The style 'backgroundImage' is only supported by type 'flexlib.mdi.containers.MDIWindow' with the theme(s) 'halo'.	DesktopPublishWindow.mxml	/bigbluebutton-client/src/org/bigbluebutton/modules/deskshare/view/components	line 33	Flex Problem
}}}
Right click on your project, go to Flex Compiler. Change SDK to 3.5, and Flash Player version to 10.0.0.

If the client hangs at startup:
and the last line in the log is:
{{{
8/31/2010 21:16:28.795 [DEBUG] Join FAILED = <join>
  <returncode>FAILED</returncode>
  <message>Could not find conference null.</message>
</join>
}}}
Make sure your config.xml file has the host property "conf/join-mock.xml".

If your client throws an error at startup saying it cannot find the join-mock.xml, make sure you copy it over from bbb-client/resources/dev into bbb-client/src/conf.#summary How to develop BigBlueButton 0.71

<wiki:toc max_depth="4" />

= Talking to the developers =
Write to the [http://groups.google.com/group/bigbluebutton-dev/topics?gvc=2&pli=1 bigbluebutton-dev] mailing list, or visit the #bigbluebutton channel on Freenode, using IRC.

= Setting up a !BigBlueButton Development Environment =
The easiest way to develop !BigBlueButton is through an already setup Virtual Machine, which you can download [BigBlueButtonVM here]. The VM has tools already set up which will get you up and running quickly. The VM has an added benefit in that you can develop on it from your Windows or Mac environment, where you can get access to Flash Builder. This document explains how to develop with the VM in mind.

== Acessing your VM ==
From your Windows environment, you'll want to access the !BigBlueButton source code that resides on your VM.  To do this, login to the VM as `firstuser` and issue the following command

{{{
bbb-conf --setup-samba
}}}

This script will share the `/home/firstuser/dev` on your VM so you can access it from within Windows.  Some editors (such as Eclipse) can only access drives (not network shares).  To map this network share to a windows drive (e.g. V:), open Windows Explorer, hit the Alt key, and choose the menu command Tools -> Map Network Drive. For the path, enter `\\<ip>\firstuser`, the ip being the local address of your VM.

See the [BBBConf] page for troubleshooting tips.


== Check Out the Source Code ==
Type the following command to checkout !BigBlueButton from our [http://www.github.com/bigbluebutton github repository].
{{{
bbb-conf --checkout
}}}

This will checkout into {{{/home/firstuser/dev/source/bigbluebutton}}}. 

If you want to learn more about Git, read the book [http://progit.org/book/ Pro Git] especially chapters 1, 2, 3, 5. [http://help.github.com/ GitHub Help] has a lot of information too.

== Compile the Client ==
To setup a development environment for bbb-client, enter the following command
{{{
bbb-conf --setup-dev client
}}}
This will setup some directories and modify nginx config to use your development client.

Everything is now setup to compile bbb-client.

To compile the client:
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-client
ant
}}}

Behind the scenes, nginx is now loading the client from `~/dev/source/bigbluebutton/bigbluebutton-client/bin`.
If the IP address for your !BigBlueButtom VM is 192.168.0.211, you should be able to browse to http://192.168.0.211/, login to the web interface, and see your new client load.    

Every time you make a change to the client source, you need to rebuild it using the 'ant' command in order for the changes to show in your browser. If you haven't changed the localization files then you only need to run
{{{
ant modules
}}}
This will skip building the localization .swf files, and save you a lot of time.

=== Returning to the Packaged Client ===
To revert back to the bbb-client installed from packages, edit `/etc/nginx/sites-available/bigbluebutton` and make the entry for `/client` match the following.

{{{
location /client {
	root    /var/www/bigbluebutton;
	index  index.html index.htm;
}
}}}

Then restart nginx.

{{{
sudo service nginx restart
}}}

== Flash Builder or How to Work with the Client ==
To develop the client using Flash Builder, follow these steps:
 # Install Flash Builder on your Windows/Mac machine.
 # Setup samba on the VM and mount the VM drive as described earlier in this document.
 # In Flash Builder, import the project by going to File->Import->Flash Builder Project.
   # Select the Project Folder radio
   # Click Browse and choose the bigbluebutton-client directory in your VM. For example W:\dev\source\bigbluebutton\bigbluebutton-client
   # Click finish.
 # Right click on the project, go to Properties->Flex Compiler, and change the Flex version to 3.5. (!BigBlueButton does not yet work with Flex 4)
 # In the same window, make sure the Flash Player minimum version is set to at least 10.0.0.
 # In the Flex Modules section of the properties window, add all the modules that you would like compiled with bbb-client. The modules are mxml files located in the src/ directory (default package).
 # In the Package Explorer navigate to src/(default package) and _Right Click_ on !BigBlueButton.mxml and click on Set As Default Application.
 # Compile the client in Flash Builder, then open the client in your browser by going to the VM IP. The client running there should now be the client in your Flash Builder environment.
 This approach is limited in the sense that you can't use the Run button within Flash Builder to launch the client. You also can't use the Flex debugger. To be able to launch the client from Flash Builder, do the following:
 # On the client code, edit {{{src/conf/config.xml}}} and change the 'host' property of the !ViewersModule to point to {{{conf/join-mock.xml}}}.
 # You should now be able to launch from Flash Builder using the Run/Debug button.

== Your First Modification of !BigBlueButton ==
*<font color="44388">_Draft_</font>*<br />
At this point we are going to adorn our rubber boots and jump right in.  We are going to make a small modification to the UI so that you can start perusing the code.
 # In the Package Explorer navigate to src -> org.bigbluebutton -> main -> views -> !MainApplicationShell.mxml
 # Scroll down to near the end of the document and look for {{{<mx:Label text="{ResourceUtil.getInstance().getString('bbb.mainshell.copyrightLabel2',[appVersion])}" id="copyrightLabel2"/>}}}.  This string is the Footer label that contains copyright data, version, etc.
 # Modify the text property to change the text that is displayed. For example:
 {{{
 <mx:Label text="My Modified BigBlueButton Client" id="copyrightLabel2"/>
 }}}
 # To recompile the project save the file you just edited
Congradulations, you have now made your first change to !BigBlueButton.
 
=Developing Other Components of !BigBlueButton=
== Setting up the Development Environment ==
=== !BigBlueButton Web ===
The !BigBlueButton web interface is written in grails, so the development environment different from building the Client (bbb-client).  As before, the first step is to use `bbb-conf` to setup the environment.
<ol>
 <li>Configure the environment
{{{
bbb-conf --setup-dev web
}}}
	This script does the following steps:
  # sets your local IP address into  `~/.grails/bigbluebutton-config.properties`
  # make all files in `/var/bigbluebutton` writable by everyone
	The first step sets up a global property for grails so it knows the IP address of your server when it runs.  The second step opens the permissions to slides directory so `firstuser` can upload a presentation.

	 <b>Note</b>:  If you get an error upload slides when running bbb-web as `firstuser`, run the command `sudo chmod -R ugo+rwx /var/bigbluebutton`.</li>

 <li>Stop Tomcat so you can compile your bbb-web</li>
{{{
sudo service tomcat6 stop
}}} </li>
 <li>Compile and run bbb-web
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-web
ant
}}} </li>
</ol>
The default task for ant here is to make sure your libraries are up-to-date (using ivy), then execute the command `grails run-app`.  This will output the console to the command line, making it easier for you to see any exceptions thrown by grails.  To stop the grails server, just hit CTRL-C.

If you want to revert back to the web interface installed by the package bbb-web, stop grails and restart the tomcat6 server.
{{{
sudo service tomcat6 start
}}}

 *Note:* After starting the tomcat server try to join a conference. If you receive the message "The page you are looking for is temporarily unavailable. Please try again later.", then the grails server could still be running and not tomcat. Enter the following command

{{{
sudo bbb-conf -c
}}}

If the issue is listed under the Potential Problems heading then to resolve the issue enter

{{{
ps -aef | grep grails
}}}

This will list the grails process. Determine its pid (process id) and kill it. Then start the tomcat server. If the pid was 5012, enter the following commands.

{{{
sudo kill -9 5012
sudo service tomcat6 start
}}}

== BigBlueButton Apps == 

The !BigBlueButton web apps runs within the red5 server.  Unlike development with bbb-web and bbb-client, where we could leave the packaged versions installed, because there is only one red5 server on the VM, we need to remove the existing bbb-apps first.  (Don't worry, you can easily restore it as shown at the end of this section).

To setup a development environment for bbb-apps, enter the following command

{{{
bbb-conf --setup-dev apps
}}}

This will 

  # Enable write access to `/usr/share/red5/webapps`
  # Uninstall the existing `bbb-apps` package
  # Creates a `~/.bbb-apps-build.properties` file that sets the property `red5.home = /usr/share/red5`

Uninstalling the existing `bbb-apps` package will stop the red5 server, remove the directory `/usr/share/red5/webapps/bigbluebutton`, and restart red5.

At this point red5 is still running.  Before we deploy the local version of bbb-apps, let's stop the red5 server.  Open a new terminal window (if you are on windows, we recommend installing [http://www.chiark.greenend.org.uk/~sgtatham/putty/ putty]) and enter the command. 

{{{
sudo service red5 stop
}}}

We'll come back to this separate terminal window in a moment.  Now, let's build and deploy the local copy of bbb-apps.

{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-apps/
gradle war deploy
}}}

At this point, the ant script has copied the local build of bbb-apps to `/usr/share/red5/webapps/bigbluebutton`.  Now switch back to the second terminal window and enter the following command:

{{{
cd /usr/share/red5
sudo -u red5 ./red5.sh
}}}

You'll now see all the output from red5 directly at the console.  Like running the grails server at the command line, running red5 from the command line gives you easy visibility to any errors or exceptions.

If you want to revert back to the packaged version of !BigBlueButton apps, do the following

{{{
rm -rf /usr/share/red5/webapps/bigbluebutton
sudo apt-get install bbb-apps
sudo service red5 start
}}}

= Using the Development Environment =

== Pre-requisites ==
In this environment, we assume you are developing on Windows with Eclipse and Flash Builder. Also, you have the !BigBlueButton VM running on [http://www.vmware.com/ VMware]/[http://www.virtualbox.org/ VirtualBox] and mapped to a drive in your windows machine (see Setting up access to the VM from windows above).

On Windows:
 # Install JDK 6 and add JAVA_HOME in your environment variables
 # Install Eclipse
 # Install the [http://www.scala-ide.org/ Scala Eclipse plugin]
 # Install the [http://groovy.codehaus.org/Eclipse+Plugin Groovy Eclipse plugin]
 # Install Flash Builder
 # Install Grails 1.1.1 and add GRAILS_HOME in your environment variables

=== Client ===
 * See [DevelopBigBlueButtonCurrent#Setting_up_Flash_Builder_to_work_with_the_client Setting up Flash Builder to work with the client].

=== BBB Commons ===
 # The bbb-commons contain classes that are common to bbb-web and bbb-apps.
{{{
cd ~/dev/source/bigbluebutton/bbb-common-message
}}}
 # Generate Eclipse project files
{{{
gradle eclipse
}}}
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bbb-common-message}}}
 # Setup the build path. Right-click on the project, chose Build Path->Configure Build Path
 # Click on the Source tab and add folder {{{src/main/java}}}
 # Compile the classes
{{{
gradle jar  
}}}
 # Copy the jar file to /home/firstuser/dev/repo
{{{
gradle uploadArchives 
}}}

=== BBB Web ===
 # Change directory to {{{bigbluebutton-web}}}
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-web
}}}
 # Download all dependencies specifically bbb-commons from {{{/home/firstuser/dev/repo}}}
{{{
gradle copyToLib 
}}}
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bigbluebutton-web}}}
 # Start bbb-web
{{{
ant 
}}}

*NOTE*: If you encounter an error with the webapp redirecting to an invalid client, open the file {{{./grails-app/conf/bigbluebutton.properties}}} and edit the line bigbluebutton.web.serverURL to point to the url of your machine.

=== BBB apps ===
 # Change directory to {{{bigbluebutton-apps}}}
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-apps
}}}
 # Generate Eclipse project files
{{{
gradle eclipse
}}}
 # Download all dependencies specifically bbb-commons from /home/firstuser/dev/repo
{{{
gradle resolveDeps
}}}
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bigbluebutton-apps}}}
 # Right-click on the project and add Scala Nature and Groovy Nature
 # Setup your build path and library
 # Build the application
{{{
gradle war
}}}
 # Deploy the application to Red5 ({{{/usr/share/red5/webapps}}})
{{{
sudo gradle deploy
}}}

=== Video app ===
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bbb-video}}}
{{{
cd ~/dev/source/bigbluebutton/bbb-video
}}}  
 # Download all dependencies
{{{  
ant resolve
}}}
 # Build the application
{{{
ant dist
}}}
 # Deploy the application to Red5 ({{{/usr/share/red5/webapps}}})
{{{
ant deploy
}}}

=== Voice app ===
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/bbb-voice}}}
{{{
cd ~/dev/source/git/bigbluebutton/bbb-video
}}}
 # Download all dependencies 
{{{
gradle copyToLib
}}}
 # Build the application
{{{
gradle war
}}}
 # Deploy the application to Red5 (/usr/share/red5/webapps)
{{{ 
gradle deploy
}}}

=== Desktop Sharing app ===
 # Import to your Eclipse by File->New->Java Project and then choose Create project from existing source pointing to your {{{~/dev/source/git/bigbluebutton/deskshare}}}
{{{
cd ~/dev/source/bigbluebutton/deskshare
}}}
 # Download all dependencies 
{{{
gradle copyToLib
}}}
 # Build the server component
{{{ 
cd app
gradle war
}}}
 # Deploy the application to Red5 ({{{/usr/share/red5/webapps}}})
{{{ 
gradle deploy
}}}
 # To build the applet
{{{  
cd applet
gradle jar
}}}
 # Create the signing key
{{{
ant create-signing-key
}}}
 # Sign the applet
{{{ 
ant sign-jar
}}}
 # Copy deskshare/applet/build/libs/bbb-deskshare-applet-0.64.jar to ~/dev/source/bigbluebutton/bigbluebutton-client/resources
{{{
cp ~/dev/source/bigbluebutton/deskshare/applet/build/libs/bbb-deskshare-applet-0.64.jar ~/dev/source/bigbluebutton/bigbluebutton-client/resources/prod
}}}
 # compile the bbb-client (see Developing with bbb client)

=== TIPS ===
* Run bbb-conf --check *
Run {{{sudo bbb-conf --check}}} to see if there are any potential problems.

====Running Red5====

It is better to have multiple ssh windows when developing. On one window, you can start and stop Red5.
 # Stop Red5
{{{
sudo service red5 stop
}}}
 # cd to Red5 directory
{{{
cd /usr/share/red5
}}}
 # Start Red5 as red5 user
{{{
sudo -u red5 ./red5.sh
}}}

In another window, you can make your code changes and deploy to Red5, e.g.
{{{
cd ~/dev/source/git/bigbluebutton/bigbluebutton-apps
}}}
 # Make some changes
 # Build
{{{
gradle war
}}}
 # Deploy 
{{{
gradle deploy
}}}


====Remove BBB packages====

List the BBB packages by typing
{{{
dpkg -l | grep bbb
}}}

which results:
{{{
ii  bbb-apps                        0.71ubuntu2             BigBlueButton applications for Red5
ii  bbb-apps-deskshare              0.71ubuntu2             BigBlueButton deskshare module for Red5
ii  bbb-apps-sip                    0.71ubuntu2             BigBlueButton SIP module for Red5
ii  bbb-apps-video                  0.71ubuntu2             BigBlueButton video module for Red5
ii  bbb-client                      0.71ubuntu15            BigBlueButton Flash client
ii  bbb-common                      0.71ubuntu6             BigBlueButton common files
ii  bbb-config                      0.71ubuntu6             BigBlueButton group package
ii  bbb-freeswitch-config           0.71ubuntu2             BigBlueButton group package
ii  bbb-openoffice-headless         0.71ubuntu2             BigBlueButton wrapper for OpenOffice
ii  bbb-voice-conference            0.71ubuntu3             BigBlueButton voice conference files
ii  bbb-web                         0.71ubuntu4             BigBlueButton web interface
ii  bigbluebutton                   0.71ubuntu4             Open Source Web Conferencing System (bbb)
}}}

 * To remove a package type {{{apt-get remove <package name>}}}
	Example, if you want to remove bbb-apps
{{{
sudo apt-get remove bbb-apps
}}}

= Developing on the bleeding edge =

== Building the client ==
Here are some extra steps you need to do if you are developing on the {{{master}}} branch. These extra steps are needed because of the changes to the code that's still in development. If you run into issues, please send email to the bigbluebutton-dev mailing list.

Make sure you are on the tip of the blade.
{{{
git pull origin master
}}}

We have added Speex support for BBB Voice. This requires version 3.5 of the Flex SDK. Thus, to build the client, you need to download Flex 3.5 SDK from
http://opensource.adobe.com/wiki/display/flexsdk/Download+Flex+3

Unzip the SDK into your !FlexBuilder/sdk folder and modify the compiler settings to use this SDK.

 # To build using {{{ant}}}, unzip the folder into {{{/home/firstuser/dev/tools}}}.
{{{
cd /home/firstuser/dev/tools
}}}  
 # Uncompress the SDK. This will uncompress the files
{{{
unzip -d flex_sdkflex-3.5.0.12683 flex_sdk_3.5.0.12683_mpl.zip
}}}
 # Check if you have tofrodos
{{{
fromdos
}}}
If it says command not found, you have to install tofrodos
{{{ 
sudo apt-get install tofrodos
}}}
 # Make the needed files unix compatible and executable
{{{
cd flex-3.5.0.12683/bin
fromdos aasdoc acompc amxmlc asdoc compc copylocale digest fcsh fdb mxmlc optimizer
chmod 755 aasdoc acompc amxmlc asdoc compc copylocale digest fcsh fdb mxmlc optimizer
}}}  
 # Backup the included flex3 folder to flex-3.4.1
{{{
cd /home/firstuser/dev/tools
mv flex3 flex-3.4.1
}}}
 # Create a softlink to the 3.5 SDK as the FLEX_HOME env var points to {{{/home/firstuser/dev/tools/flex3}}}
{{{
ln -s flex-3.5.0.12683 flex3
cd /home/firstuser/dev/source/bigbluebutton/bigbluebutton-client
ant
}}} 
*Note*: {{{gradle copyToLib}}} has been changed to {{{gradle resolveDeps}}}, if one doesn't work, try the other as not all instances have been converted.

You will need to run the grails version of bigbluebutton-web which will allow you to see debugging information.  In order to do this tomcat6 needs to be stopped.
{{{
sudo service tomcat6 stop
cd ~/dev/source/bigbluebutton/bigbluebutton-web
}}}
 * Did you already run "bbb-conf --setup-dev web"? If not, run it now


{{{
grails run-war
}}}

Copy a new config.xml as the loading of modules have changed.
{{{
cd ~/dev/source/bigbluebutton/bigbluebutton-client
cp resources/config.xml.template src/conf/config.xml
}}}
 * Edit {{{config.xml}}} replacing "HOST" with your IP

== Creating a new !BigBlueButton Module ==
Follow this short [SampleModule tutorial].
 
 
=Troubleshooting=
==Debugging FreeSWITCH==
To start FreeSWITCH so you can see any errors produced by it run:
{{{
sudo /opt/freeswitch/bin/fs_cli
}}}

If voice isn't working in the BBB interface or your listeners are not showing up the most likely reason is that FreeSWITCH and Red5 are not communicating properly.
Check the configuration files and make sure that FreeSWITCH and Red5 are pointing at each other.
Edit {{{/opt/freeswitch/conf/autoload_configs/event_socket.conf.xml}}}. 
{{{
vi /opt/freeswitch/conf/autoload_configs/event_socket.conf.xml
}}}
Check the listen-ip parameter
{{{
<param name="listen-ip" value="192.168.0.211"/>
}}}

Edit {{{/usr/share/red5/webapps/bigbluebutton/WEB-INF/bigbluebutton.properties}}}
Set esl.host to your IP
{{{
esl.host=192.168.0.211
}}}

Lastly, make sure that the sip.server.host property in {{{/usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties}}} is set to your FreeSWITCH server.
{{{
vi /usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties
}}}
Edit the host address to match you own.
{{{
sip.server.host=192.168.0.211
}}}

*Note*: Make sure your two Red5 IPs are ponting to FreeSWITCH and that your FreeSWITHCH IP ip pointing to your Red5 sever.  Otherwise, Red5 won't know what SIP server to use and both FreeSWITCH and Red5 won't be able to communicate events with eachother (stopping the voice users from showing up in the Listeners Window).

==Launching from Flex/Flash Builder==
If you get the compile error:
{{{
unable to open 'W:\dev\source\bigbluebutton\bigbluebutton-client\tests\unit'	bigbluebutton-client		Unknown	Flex Problem
}}}
Just create the missing directories. This is a problem caused by an improperly generated .actionScriptProperties file in bbb-client/


If you get the compile error:
{{{
The style 'backgroundImage' is only supported by type 'flexlib.mdi.containers.MDIWindow' with the theme(s) 'halo'.	DesktopPublishWindow.mxml	/bigbluebutton-client/src/org/bigbluebutton/modules/deskshare/view/components	line 33	Flex Problem
}}}
Right click on your project, go to Flex Compiler. Change SDK to 3.5, and Flash Player version to 10.0.0.

If the client hangs at startup:
and the last line in the log is:
{{{
8/31/2010 21:16:28.795 [DEBUG] Join FAILED = <join>
  <returncode>FAILED</returncode>
  <message>Could not find conference null.</message>
</join>
}}}
Make sure your config.xml file has the host property "conf/join-mock.xml".

If your client throws an error at startup saying it cannot find the join-mock.xml, make sure you copy it over from bbb-client/resources/dev into bbb-client/src/conf.