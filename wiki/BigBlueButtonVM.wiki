#summary How to setup your own BigBlueButton Virtual Machine

<wiki:toc max_depth="2" />

= How to setup your own !BigBlueButton Server in a few minutes =

Many universities and colleges have told us they want to run their own version  !BigBlueButton behind their firewall.  In addition, developers have asked how to setup a development environment to enhance and extend !BigBlueButton.

In response to these requests, we've created a Ubuntu-based virtual machine (VM) that makes it easy for anyone to download and run a !BigBlueButton server.  The VM runs under VMWare Player, which is available on Unix, Windows, or Mac.  We've also pre-configured the VM so it can serve as a full [DevelopingBBB development environment].  We've added scripts (using `bbb-conf`) to make it easy for a developer to checkout !BigBlueButton's source from Google Code repository, make local changes, and, with a few commands, re-compile various components of !BigBlueButton for development and testing.  

Prerequisites:
  # VMWare Player (or VMWare Workstation) for Windows or Unix, or VM Fusion for Mac
  # A DHCP Server for the VM to acquire an IP address on boot

The second point is key: the VM must be able to connect to the internet to update from packages.  If it does not acquire an IP address, it won't be able to finish the setup of !BigBlueButton.

<wiki:video url="http://www.youtube.com/watch?v=--yC6LpeFqA" />

Note: This video refers to 0.64, but the steps are valid for 0.71a.

== Installing !BigBlueButton VM  ==

  1.  Download and uncompress the the VM. 

Download bigbluebutton071a-vm.zip from !SourceForge: [http://sourceforge.net/projects/bigbluebutton/files/  Download ]

*Note:* We recommend you download and try the !BigBlueButton 0.8-beta-4 VM.  We'll be updating these instructions (and the screen shots) for 0.8 when the final version is released.

  2.  Open the enclosed folder.


http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/vm/vm_icons.png

  3.  Double-click on the bigbluebutton-vm.vmx icon.  

This will start VMWare Player (or VMWare Workstation) and boot the VM. Note: In VMWare, make sure the networking is set to *Bridged*, not NAT.  

The !BigBlueButton VM takes about 10 minutes to first initialize.  Sit back, relax, go watch some youtube videos.  During this time, the !BigBlueButton VM goes through its initial startup script that 

  * Sets up the networking (acquire an IP address from a DHCP server)
  * Installs the  !BigBlueButton packages
  * Configures  !BigBlueButton to use the VM's current IP address
  * Installs OpenSSH

When it's done, you'll see a a login message.  *NOTE:* The VM has been pre-configured to have the following user-id/password:

  user-id: *firstuser*

  password: *default*

*To secure your server, immediately login with the above user-id/password.*  This password is set to expire, so you'll be asked to enter the password *default* again, then to provide a new password (entering it twice to confirm).  Again, do this now as it will secure your server.  

After resetting the default password, you'll get the following welcome message (this appears each time you login as firstuser).

http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/vm/vm-welcome.png

Note: Due to an upgrade to OpenOffice 3.2, you'll need to restart the VM after this first boot sequence to have OpenOffice properly running for document conversation.  The next time the VM starts everything will be working properly.

== Installing the !BigBlueButton VM using !VirtualBox ==

See [BigBlueButtonVMVirtualBox Running BigBlueButton VM in Virtual Box].

== Running the !BigBlueButton VM ==

At this point, you've got a full !BigBlueButton server up and running.  Open a web browser to the URL provided using the IP address of the VM.  
  
http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/vm/vm-join.png

Enter whatever name you like and then click Join.  You'll join the default meeting.

http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/vm/vm-bbb-running.png

== Developing !BigBlueButton == 

We've included all the development tools in this VM to compile and deploy the source for bigbluebutton-client, bigbluebutton-web, and bigbluebutton-apps. See [http://code.google.com/p/bigbluebutton/wiki/DevelopingBBB developing BigBlueButton] for more information.

= Upgrading the !BigBlueButton VM =



== How to upgrade to the next release == 

This is where packages make life easy.

The !BigBlueButton components are installed as Ubuntu packages.  The VM already has apt configure to check the repository http://archive.bigbluebutton.org for updates.  This means, when we ship !BigBlueButton 0.8 (for example), you'll be able to upgrade your server with two commands.

{{{
  # sudo apt-get update
  # sudo apt-get dist-upgrade
}}}

When you run these commands, you'll see !BigBlueButton download a packages for the new release.  You may be prompted to update an existing configuration file.

*Note*: Best to always check the [http://code.google.com/p/bigbluebutton/wiki/ReleaseNotes release notes] for specific instructions to upgrade to a new release.

When updating, you'll see the upgrade messages.

http://bigbluebutton.googlecode.com/svn/trunk/bbb-images/vm/vm-apt-get-upgrade.png




= Troubleshooting =

== The console gives an error when booting ==

When the VM first boots, it acquires an IP address and runs a setup script to finish the installation of !BigBlueButton.   The script:
  # updating the packages 
  # installs !BigBlueButton

The update step ensures that any updates to packages issued after the release of the !BigBlueButton VM will be automatically downloaded before installation proceeded.

The most common error that prevents update and installation is occurs when the !BigBlueButton VM failed to acquire an IP address.  When this occurs, you'll see errors in the console when booting.

You can manually finish the installation process, but you first need to ensure the VM has (1) acquired an IP address and (2) the IP address is accessible by the host computer.

First, check in VMWare Player that has networking set to *bridged*.  Next, type

{{{
    ping google.com
}}}

You should get some ping results

{{{
   PING google.com (72.14.204.99) 56(84) bytes of data.
   64 bytes from iad04s01-in-f99.1e100.net (72.14.204.99): icmp_seq=1 ttl=54 time=4.54 ms
   64 bytes from iad04s01-in-f99.1e100.net (72.14.204.99): icmp_seq=2 ttl=54 time=4.42 ms
}}}

If not, it means that the VM is unable to acquire an IP address from a DHCP server on the network.  If there is a DHCP serer, you can try 

{{{
    sudo /etc/init.d/networking restart
}}}

Try the ping command again.  If you are unable to acquire an IP address, check out this resource [https://help.ubuntu.com/9.04/internet/C/index.html Ubuntu Networking].

Next, you can manually finish the setup to !BigBlueButton with the following commands:

{{{
    sudo apt-get update
    sudo apt-get upgrade
    sudo apt-get install bigbluebutton
}}}

There should be no errors when you type the above three commands.

== The IP address of my VM has changed and now !BigBlueButton does not work ==
Next, you'll need to ensure that !BigBlueButton is listening to the IP address of your VM.  One symptom is when you try to access !BigBlueButton through the web browser you get the `Welcome to nginx!` message.

To check your current environment for possible problems that might prevent !BigBlueButton from running, type the following command:

{{{

   sudo bbb-conf --check

}}}

You should see output such as 

{{{ 
$ sudo bbb-conf --check
Current Configuration:

/var/www/bigbluebutton/client/conf/config.xml (bbb-client)
                 IP for tunnel check: 192.168.0.163
                  IP for rtmp (red5): 192.168.0.163
          host for bbb-web interface: 192.168.0.163

/etc/nginx/sites-available/bigbluebutton (configuration file nginx)
                         server_name: 192.168.0.163
                                port: 80
                client document root: /var/www/bigbluebutton

/var/lib/tomcat6/webapps/bigbluebutton/WEB-INF/classes/bigbluebutton.properties (bbb-web)
                                host: 192.168.0.163

/var/lib/tomcat6/webapps/bigbluebutton/demo/bbb_api_conf.jsp (API demos)
                                host: 192.168.0.163

/etc/asterisk/bbb_extensions.conf (asterisk)
                   conference module: konference

}}}

If there are any problems (i.e. if bbb-conf detects that red5 isn't running), you'll see a warning message at the bottom.

The output from above showed that !BigBlueButton's configuration files were listening to IP address 192.168.0.163.  When you type the command, if the IP address shown for your output differs from the IP address of your VM, you can change the IP address that !BigBlueButton is using `bbb-conf`.  

For example, if the output from `ifconfig` shows your VM is listening to IP address 192.168.0.125, then issue the following command

{{{

  sudo bbb-conf --setip 192.168.0.125

}}}


If you need to restart !BigBlueButton, do the command

{{{

   bbb-conf --clean

}}}

and this will do a clean restart.  


== Check if you have a internet connection ==

{{{
ping www.google.com
}}}

If you get an error saying your eth0 is not connected, check if the VM is using eth1:

{{{
ifconfig -a
}}}

If it shows the following:

{{{
eth1      Link encap:Ethernet  HWaddr 00:0c:29:dd:b4:51
          inet addr:192.168.0.154  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:29ff:fedd:b451/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4080349 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3932137 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1216680270 (1.2 GB)  TX bytes:822963271 (822.9 MB)
          Interrupt:19 Base address:0x2000

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:12938 errors:0 dropped:0 overruns:0 frame:0
          TX packets:12938 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:40299608 (40.2 MB)  TX bytes:40299608 (40.2 MB)
}}}

Make it use eth0 instead
{{{
vi /etc/udev/rules.d/70-persistent-net.rules
}}}

This will show:
{{{
# This file was automatically generated by the /lib/udev/write_net_rules
# program, run by the persistent-net-generator.rules rules file.
#
# You can modify it, as long as you keep each rule on a single
# line, and change only the value of the NAME= key.

# PCI device 0x1022:0x2000 (pcnet32)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="00:0c:29:23:d1:b3", ATTR{type}=="1", KERNEL=="eth*", NAME="eth1"

# PCI device 0x1022:0x2000 (pcnet32)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="00:0c:29:dd:b4:51", ATTR{type}=="1", KERNEL=="eth*", NAME="eth0"

}}}

Swap the two entries by editing "NAME=eth1" to "NAME=eth0" and vice versa.

Reboot your machine. Check if you manage to connect to the internet. Make sure the VM's network adapter is using a Bridged connection instead of NAT. On the VMWare player this is enabled in the Devices menu at the top.

More info can be found here http://ubuntuforums.org/showthread.php?t=221768



== I'm still having problems ==

If you've tried both the above commands and your !BigBlueButton server is not working, please post to our [http://groups.google.com/group/bigbluebutton-setup/topics?gvc=2 bigbluebutton-setup] mailing list.  